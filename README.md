# Bupgram

> ì¼ìƒì„ ê³µìœ í•˜ê³  ìœ ì €ë¼ë¦¬ ì†Œí†µí•  ìˆ˜ ìˆëŠ” Thread ê¸°ë°˜ì˜ SNSì•±ì…ë‹ˆë‹¤.

<!--
<p align="center">
  <img src="https://github.com/Seungwoo-Seo/ExemplaryRestaurantIB/assets/72753868/f7674e21-7dab-4d82-b0f3-17434679f683" width="130">
  <img src="https://github.com/Seungwoo-Seo/ExemplaryRestaurantIB/assets/72753868/e50718e4-8afc-4c1d-bbce-ef2a8aca5024" width="130">
  <img src="https://github.com/Seungwoo-Seo/ExemplaryRestaurantIB/assets/72753868/90ae0dcd-99ab-462b-b0a1-b3653c8827cc" width="130">
  <img src="https://github.com/Seungwoo-Seo/ExemplaryRestaurantIB/assets/72753868/a7fb2876-dc56-4ce7-a9cc-1c5dd1e99f89" width="130">
  <img src="https://github.com/Seungwoo-Seo/ExemplaryRestaurantIB/assets/72753868/0db88594-bb32-46ec-8346-3ce1b01da748" width="130">
  <img src="https://github.com/Seungwoo-Seo/ExemplaryRestaurantIB/assets/72753868/184e3b7d-8b74-4228-b2f3-767c618a9e7d" width="130">
</p>
-->

## ëª©ì°¨

- [ğŸš€ ì£¼ìš” ê¸°ëŠ¥](#-ì£¼ìš”-ê¸°ëŠ¥)
- [ğŸ’» ê¸°ìˆ  ìŠ¤íƒ](#-ê¸°ìˆ -ìŠ¤íƒ)
- [ğŸ“± ì„œë¹„ìŠ¤](#-ì„œë¹„ìŠ¤)
- [ğŸš§ ê¸°ìˆ ì  ë„ì „](#-ê¸°ìˆ ì -ë„ì „)
- [ğŸ›  íŠ¸ëŸ¬ë¸” ìŠˆíŒ…](#-íŠ¸ëŸ¬ë¸”-ìŠˆíŒ…)
- [ğŸ“ íšŒê³ ](#-íšŒê³ )
- [ğŸ–¼ ì•„ì´ì½˜ ì¶œì²˜ ë° ì €ì‘ê¶Œ ì •ë³´](#-ì•„ì´ì½˜-ì¶œì²˜-ë°-ì €ì‘ê¶Œ-ì •ë³´)

## ğŸš€ ì£¼ìš” ê¸°ëŠ¥

- ê²Œì‹œê¸€ ëª©ë¡ ë° ìƒì„¸ ì •ë³´ ì¡°íšŒ
- ë³¸ì¸ê³¼ íƒ€ì¸ì˜ ê²Œì‹œê¸€ì— ì¢‹ì•„ìš”/ì·¨ì†Œ
- ë³¸ì¸ê³¼ íƒ€ì¸ì˜ ê²Œì‹œê¸€ì— ëŒ“ê¸€ CRUD
- íƒ€ì¸ ê³„ì • íŒ”ë¡œìš°/ì–¸íŒ”ë¡œìš°
- íšŒì›ì¸ì¦

## ğŸ›  êµ¬í˜„ ê¸°ìˆ 

- `Alamofire`ë¥¼ ê¸°ë°˜ìœ¼ë¡œ `multipart/form-data` í˜•ì‹ì„ ì‚¬ìš©í•˜ì—¬ `ì´ë¯¸ì§€ë¥¼ ì—…ë¡œë“œ` êµ¬í˜„
- `AuthenticationInterceptor`ë¥¼ í™œìš©í•´ `JWT` ê¸°ë°˜ì˜ `AccessToken` ê°±ì‹ ê³¼ `RefreshToken` ë§Œë£Œ ë¡œì§ êµ¬í˜„
- `cursor`ê¸°ë°˜ í˜ì´ì§€ë„¤ì´ì…˜ êµ¬í˜„
- `Keychain`ì„ í™œìš©í•˜ì—¬ `AccessToken`ê³¼ `RefreshToken`ì˜ `CRUD` êµ¬í˜„
- `Optimistic UI` êµ¬í˜„

## ğŸ’» ê¸°ìˆ  ìŠ¤íƒ

- `Swift`
- `MVVM`, `Router`, `Input-Output`, `Singleton`
- `UIKit`, `PhotosUI`
- `Codable`, `CodeBase UI`, `AutoLayout`, `DiffableDataSource`, `CompositionalLayout`, `Keychain`
- `RxSwift`, `RxDataSource`, `Alamofire`, `SnapKit`, `Kingfisher`, `Tabman`, `IQKeyboardManager`, `PanModal`

## ğŸ“± ì„œë¹„ìŠ¤

- ìµœì†Œ ë²„ì „ : iOS 15.0
- ê°œë°œ ì¸ì› : 1ì¸
- ê°œë°œ ê¸°ê°„ : 2023ë…„ 11ì›” 20ì¼ ~ 2023ë…„ 12ì›” 20ì¼ (1ê°œì›”)

## ğŸš§ ê¸°ìˆ ì  ë„ì „

// ê¸°ìˆ ì  ë„ì „
// 1. ì˜½í‹°ë¨¸ì‹œê¸° ui êµ¬í˜„í•œê³  (ì¢‹ì•„ìš”, íŒ”ë¡œìš°)
// 2. ì¸í„°ì…‰í„°

// íŠ¸ëŸ¬ë¸” ìŠˆíŒ…
// 1. ì—¬ê¸°ì— ê·¸ ë ˆì´ì•„ì›ƒ ì—…ë°ì´íŠ¸ê°€ ì™€ì•¼ì œ 
// 2. multipart/form-data` í˜•ì‹ì„ ì‚¬ìš©í•˜ì—¬ `ì´ë¯¸ì§€ë¥¼ ì—…ë¡œë“œ` êµ¬í˜„

<!-- í”„ë¡œì íŠ¸ë¥¼ ì§„í–‰í•˜ë©´ì„œ ê²ªì€ ê¸°ìˆ ì ì¸ ë„ì „ê³¼ ì–´ë–»ê²Œ í•´ê²°í–ˆëŠ”ì§€ì— ëŒ€í•œ ì„¤ëª…ì„ ì¶”ê°€í•œë‹¤. -->
### 1. `AuthenticationInterceptor`ë¥¼ í™œìš©í•´ `JWT` ê¸°ë°˜ì˜ `AccessToken` ê°±ì‹ ê³¼ `RefreshToken` ë§Œë£Œ ë¡œì§ êµ¬í˜„
- **ë„ì „ ìƒí™©**</br>
ëŒ€ë¶€ë¶„ì˜ API ìš”ì²­ Headerì— `AccessToken`ì„ ë„£ì–´ì¤˜ì•¼ í–ˆìŠµë‹ˆë‹¤. ë§¤ë²ˆ ìš”ì²­ ë¡œì§ì„ ì‘ì„±í•  ë•Œë§ˆë‹¤ Keychainì— ì €ì¥ëœ `token`ì„ ë„£ì–´ì£¼ê³ , ë§¤ë²ˆ ì—ëŸ¬ í•¸ë“¤ë§ í•˜ëŠ”ê²Œ ë¶ˆí¸í•˜ê²Œ ëŠê»´ì¡ŒìŠµë‹ˆë‹¤. ì´ ë¶ˆí¸í•¨ì„ ê°œì„ í•˜ê¸° ìœ„í•´ Alamofire 5.2ì— ë“±ì¥í•œ `AuthenticationInterceptor`ë¥¼ ì ìš©í•´ ë³´ì•˜ìŠµë‹ˆë‹¤.

- **ë„ì „ ê²°ê³¼**</br>
~~~swift
import Foundation
import Alamofire

struct SesacAuthenticationCredential: AuthenticationCredential {
    let accessToken: String
    let refreshToken: String

    var requiresRefresh: Bool = false
}
~~~
~~~swift
import Foundation
import Alamofire
import RxSwift

final class SesacAuthenticator: Authenticator {
    typealias Credential = SesacAuthenticationCredential

    private let disposeBag = DisposeBag()

    func apply(
        _ credential: SesacAuthenticationCredential,
        to urlRequest: inout URLRequest
    ) {
        urlRequest.headers.add(.authorization(credential.accessToken))
    }

    func refresh(
        _ credential: SesacAuthenticationCredential,
        for session: Alamofire.Session,
        completion: @escaping (Result<SesacAuthenticationCredential, Error>) -> Void
    ) {
        NetworkManager.shared.request(
            type: RefreshResponse.self,
            api: AccountRouter.refresh(refreshToken: credential.refreshToken)
        )
        .subscribe { response in
            let credential = SesacAuthenticationCredential(
                accessToken: response.token,
                refreshToken: credential.refreshToken
            )
            completion(.success(credential))

        } onFailure: { error in
            completion(.failure(error))
        }
        .disposed(by: disposeBag)
    }

    func didRequest(
        _ urlRequest: URLRequest,
        with response: HTTPURLResponse,
        failDueToAuthenticationError error: Error
    ) -> Bool {
        return response.statusCode == 419
    }

    func isRequest(
        _ urlRequest: URLRequest,
        authenticatedWith credential: SesacAuthenticationCredential
    ) -> Bool {
        let accessToken = HTTPHeader.authorization(credential.accessToken).value
        return urlRequest.headers["Authorization"] == accessToken
    }
}
~~~

## ğŸ›  íŠ¸ëŸ¬ë¸” ìŠˆíŒ…

<!-- í”„ë¡œì íŠ¸ ì¤‘ ë°œìƒí•œ ë¬¸ì œì™€ ê·¸ í•´ê²° ë°©ë²•ì— ëŒ€í•œ ë‚´ìš©ì„ ê¸°ë¡í•œë‹¤. -->
### 1. ì¢‹ì•„ìš” ì´ë²¤íŠ¸ê°€ ë°œìƒí•˜ë©´ ëª¨ë“  requestë¥¼ ë³´ë‚¼ ê²ƒì¸ê°€?
- **ë¬¸ì œ ìƒí™©**</br>

- **í•´ê²° ë°©ë²•**</br>

~~~swift
// ì¢‹ì•„ìš” ë²„íŠ¼ ëˆ„ë¥´ë©´
let didTapLikeButton = cell.communicationButtonStackView.likeButton.rx.tap
    .scan(item.isIliked) { lastState, _ in !lastState } // isSelected ìƒíƒœ í† ê¸€
    .flatMapLatest { isSelected in
        Observable<Void>.create { observer in
            // UI ì—…ë°ì´íŠ¸
            cell.communicationButtonStackView.likeButton.isSelected = isSelected
            let countString = item.localLikesCountString(isSelected: isSelected)
            cell.countButtonStackView.likeCountButton.updateTitle(title: countString)
            observer.onNext(Void())
            observer.onCompleted()
            return Disposables.create()
        }
    }
    .share()

let rowAndIsSelected = Observable.combineLatest(
    Observable.just(row),
    cell.communicationButtonStackView.likeButton.rx.observe(\.isSelected)
)

// ì´ë²¤íŠ¸ê°€ ë°œìƒí•œ ì¢‹ì•„ìš” ë²„íŠ¼ì˜ ì •ë³´ë¥¼ viewModelë¡œ ì „ë‹¬
didTapLikeButton
    .withLatestFrom(rowAndIsSelected)
    .bind(with: self) { owner, rowAndIsSelected in
        likeState.accept(rowAndIsSelected)
    }
    .disposed(by: cell.disposeBag)

// ë¬´ë¶„ë³„í•œ API requestë¥¼ ë°©ì§€í•˜ê¸° ìœ„í•´ throttle operator ì‚¬ìš©
didTapLikeButton
    .throttle(.seconds(1), latest: false, scheduler: MainScheduler.instance)
    .withLatestFrom(Observable.just(item.id))
    .bind(to: didTapLikeButtonOfId)
    .disposed(by: cell.disposeBag)
~~~
~~~swift
input.didTapLikeButtonOfId
    .flatMapLatest { (id) in
        return NetworkManager.shared.request(
            type: LikeUpdateResponseDTO.self,
            api: LikeRouter.update(id: id),
            error: NetworkError.LikeUpdateError.self
        )
        .trackActivity(activityIndicator)
        .trackError(errorTracker)
        .catch { _ in Observable.empty() }
        .map { $0.toDomain() }
    }
    .withLatestFrom(input.likeState) { (domain: $0, likeState: $1) }
    .bind(with: self) { owner, value in
        // MARK: í˜„ì¬ë¡œì¬ êµ³ì´ response ê°’ì„ ì‚¬ìš©í•  í•„ìš”ê°€ ì—†ì–´ì¡Œë‹¤.
    }
    .disposed(by: disposeBag)

input.likeState
    .bind(with: self) { owner, localLikeState in
        owner.likeState.updateValue(localLikeState.isSelected, forKey: localLikeState.row)
    }
    .disposed(by: disposeBag)
~~~

### 2. íŒ”ë¡œìš°
- **ë¬¸ì œ ìƒí™©**</br>
- **í•´ê²° ë°©ë²•**</br>
~~~swift
~~~

### 3. multipart

## ğŸ“ íšŒê³ 

<!-- í”„ë¡œì íŠ¸ë¥¼ ë§ˆë¬´ë¦¬í•˜ë©´ì„œ ëŠë‚€ ì†ŒíšŒ, ê°œì„ ì , ë‹¤ìŒì— ì‹œë„í•´ë³´ê³  ì‹¶ì€ ê²ƒ ë“±ì„ ì •ë¦¬í•œë‹¤. -->
í”„ë¡œì íŠ¸ë¥¼ ë§ˆë¬´ë¦¬í•˜ë©´ì„œ ëª‡ ê°€ì§€ ëŠë‚€ ì ê³¼ ê°œì„ í•  ì‚¬í•­ë“¤ì„ íšŒê³ ë¡œ ì •ë¦¬í•˜ê² ìŠµë‹ˆë‹¤.

ğŸ‘ ì„±ì·¨í•œ ì 
1. **Alamofire AuthenticationInterceptorë¥¼ í™œìš©í•œ JWT AccessToken ë§Œë£Œ ê°±ì‹ , RefreshToken ë§Œë£Œ ë¡œì§ ì²˜ë¦¬**</br>

ğŸ¤” ê°œì„ í•  ì 
1. ****</br>
2. ****</br>

## ğŸ–¼ ì•„ì´ì½˜ ì¶œì²˜ ë° ì €ì‘ê¶Œ ì •ë³´

ì´ í”„ë¡œì íŠ¸ì—ì„œ ì‚¬ìš©ëœ ì•„ì´ì½˜ë“¤ì€ ì•„ë˜ì™€ ê°™ì€ ì¶œì²˜ì—ì„œ ì œê³µë˜ì—ˆìŠµë‹ˆë‹¤. ê° ì•„ì´ì½˜ì˜ ì €ì‘ê¶Œì€ í•´ë‹¹ ì œì‘ìì—ê²Œ ìˆìŠµë‹ˆë‹¤. ì•„ì´ì½˜ì„ ì‚¬ìš©í•˜ë ¤ë©´ ê° ì•„ì´ì½˜ì˜ ì¶œì²˜ë¡œ ì´ë™í•˜ì—¬ ì €ì‘ê¶Œ ê´€ë ¨ ì •ë³´ë¥¼ í™•ì¸í•˜ì„¸ìš”.
